---
layout:     post
title:      工作 表格行上下移动
date:       2020-07-09
author:     violetks
header-img: img/post-violets.png
catalog: true
tags:
    - ES6
    - React
    - Antd Design
    - < 工作问题记录 >
---

**场景**：点击按钮，实现表格行的移动。也就是两行数据的交换。第一行提示最顶部无法上移，最后一行提示无法下移。

### 一、使用useSelector获取到列表数据，传给antd表格组件的dataSource

```javascript
const { projectList } = useSelector(state => state.project);

<Table
  rowKey='projectId'
  columns={columns}
  dataSource={projectList}
  pagination={pagination}
/>
```

### 二、设置表格的columns属性

这里 `render` 函数有第三个参数 `index`，可获取到表格行序号。`css` 实现两个按钮上下排列。<br>

```javascript
  const columns = [
  ...
    {
      key: 'action',
      title: '操作',
      width: 150,
      render: (text, record, index) => {
        return (
          <Fragment>
            <span className='ht-action-span'
              style={{ position: 'relative', width: '14px', height: '25px', display: 'inline-block' }}>
              <CaretUpOutlined
                style={{
                  color: index === 0 ? 'gray' : '',
                  position: 'absolute', top: '8px'
                }}
                onClick={() => { up(index, record) }} />
              <CaretDownOutlined
                style={{
                  color: index === projectList.length - 1 ? 'gray' : '',
                  position: 'absolute', top: '20px'
                }}
                onClick={() => { down(index, record) }} />
            </span>
            <span
              className='ht-action-span'
              style={{ margin: "0 8px" }}
              onClick={() => { editProject(record) }}>
              <EditOutlined />
            </span>
            <span
              className='ht-action-span'
              onClick={() => { deleteProject(record.projectId) }}>
              <DeleteOutlined />
            </span>
          </Fragment>
        )
      }
    }
  ];
```

### 三、columns操作列有上下移动两个按钮，给它们分别绑定点击事件

这里通过 `reducer` 改变数据，实现移动。<br>

之前通过 `setState` 设置了一个表格的数据源，结果造成首次进入页面表格数据为空，需要再点一下数据才出现，而且编辑等也不能自动刷新页面数据。
打印发现 `useSelector` 有延迟的效果，会给你返回多个 `projectList` ，但是前几个是空数组。<br>

```
  const up = (index, record) => {
    if (index === 0) {
      return message.warning("最顶部无法上移");
    }
    let list = projectList;
    // let prev = list[index - 1];
    // list.splice(index - 1, 1);
    // list.splice(index, 0, prev);
    // 使用ES6优化
    [list[index - 1], list[index]] = [list[index], list[index - 1]];
    dispatch({
      type: 'gproject/setProjectList',
      payload: {
        projectList: [...list]
      }
    })
  }

  const down = (index, record) => {
    if (index === projectList.length - 1) {
      return message.warning("最底部无法下移");
    } else {
      // let next = projectList[index + 1];
      // projectList.splice(index + 1, 1);
      // projectList.splice(index, 0, next);
      let list = projectList;
      [list[index], list[index - 1]] = [list[index - 1], list[index]];
      dispatch({
        type: 'gproject/setProjectList',
        payload: {
          projectList: [...list]
        }
      })
    }
  }
```