---
layout:     post
title:      ES6è¯­æ³•
date:       2019-11-23
author:     violetks
header-img: img/post-ecma.jpg
catalog: true
tags:
    - ES6
---

> å…³äºES6åœ¨ã€ŠECMAScript6 å…¥é—¨ã€‹ä¸­å·²ç»æœ‰å¾ˆè¯¦ç»†çš„æ•™ç¨‹äº†ï¼Œè¿™é‡Œä¸»è¦å†ä¸¾äº›ä¾‹å­

`ES6`ï¼Œå…¨ç§°`ECMAScript 6.0`ï¼Œæ˜¯JavaScriptçš„ç¬¬å…­ä¸ªç‰ˆæœ¬æ ‡å‡†

`ES6`ç”¨`let` å’Œ`const`å£°æ˜å˜é‡å’Œå¸¸é‡ï¼Œ`ES5`ç”¨`var`å£°æ˜

### ä¸€ã€letå’Œconst

#### 1.`let`ä½œç”¨åŸŸåªå±€é™äºå½“å‰ä»£ç å—ï¼Œæ˜¯å—çº§ä½œç”¨åŸŸï¼Œ`var`çš„ä½œç”¨åŸŸæ˜¯å‡½æ•°çº§çš„

#### 2.ä½¿ç”¨`let`å£°æ˜å˜é‡ä½œç”¨åŸŸä¸ä¼šè¢«æå‡

```javascript
{
  var str;
  console.log(str);
  str = "å¼ ä¸‰";      //varè¿™æ ·æ˜¯å¯è¡Œçš„
}
```

#### 3.åœ¨ç›¸åŒä½œç”¨åŸŸä¸‹`let`ä¸èƒ½é‡å¤å£°æ˜åŒä¸€ä¸ªå˜é‡

#### 4.`forå¾ªç¯`ä½“ç°`let`çš„çˆ¶å­ä½œç”¨åŸŸ
ä¾‹å­ï¼šç‚¹å‡»æŒ‰é’®
```javascript
<body>

<button>æŒ‰é’®1</button>

<button>æŒ‰é’®2</button>

<button>æŒ‰é’®3</button>

<script>
    var btns = document.querySelectorAll("button");
    for (var i=0;i<btns.length;i++) {
        btns[i].onclick = function () {
            alert("ç‚¹å‡»äº†ç¬¬"+ i +"ä¸ªæŒ‰é’®");
        }
    }
    //ä¸Šé¢è¿™æ ·ç‚¹å‡»æ¯ä¸ªæŒ‰é’®éƒ½æ˜¯i=3
    //æ”¹ä¸ºé—­åŒ…çš„æ–¹å¼å¯ä»¥è§£å†³
    var btns = document.querySelectorAll("button");
    for (var i=0;i<btns.length;i++) {
        (function (i) {
            btns[i].onclick = function () {
                alert("ç‚¹å‡»äº†ç¬¬"+ i +"ä¸ªæŒ‰é’®");
            }
        })(i);
    }
    //ES6ç”¨letï¼Œä½¿ä»£ç æ›´ç®€æ´
    let btns = document.querySelectorAll("button");
    for (let i=0;i<btns.length;i++) {
        btns[i].onclick = function () {
            alert("ç‚¹å‡»äº†ç¬¬"+ i +"ä¸ªæŒ‰é’®");
        }
    }
</script>

</body>
```
#### 5.constå®šä¹‰çš„å¯¹è±¡ï¼Œå±æ€§å¯ä»¥æ”¹å˜
å› ä¸ºå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹çš„ï¼Œconstä»…ä¿è¯æŒ‡é’ˆä¸å‘ç”Ÿæ”¹å˜ï¼Œä¿®æ”¹å¯¹è±¡çš„å±æ€§ä¸ä¼šæ”¹å˜å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æ˜¯è¢«å…è®¸çš„ã€‚

### äºŒã€ç®­å¤´å‡½æ•°

**1.åŸºæœ¬æ ¼å¼ï¼š**(å‚æ•°)=>{ }<br>
```javascript
// ä½¿ç”¨ç®­å¤´å‡½æ•°å¯¹æ•°ç»„æ’åº
'use strict'
var arr = [10, 20, 1, 2];
arr.sort((x, y) => {
    return x-y;
});
console.log(arr); // [1, 2, 10, 20]
```

**2.ç®€å†™ï¼š**<br>
ï¼ˆ1ï¼‰æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå‚æ•°ï¼Œ()å¯ä»¥ä¸å†™<br>
ï¼ˆ2ï¼‰å¦‚æœæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè¯­å¥å¹¶ä¸”æ˜¯`return`ï¼Œ{}å¯ä»¥ä¸å†™

**3.ä½œç”¨ï¼š**ä¿®å¤thisæŒ‡å‘
```javascript
let json={
  a: 12,
  fn: function (){
    alert(this.a);
  }
}

json.fn();   //12
```

```javascript
let json={
  a: 12,
  fn: function (){
    alert(this.a);
  }
}

let x = new Date();
x.fn = json.fn;

x.fn();   //undefined
```
ç”¨ç®­å¤´å‡½æ•°æ”¹å†™ï¼š
```javascript
let json={
  a: 12,
  fn: ()=>{
    alert(this.a);    //thisæŒ‡å‘å½“å‰ç¯å¢ƒï¼Œæ­¤å¤„æ˜¯window
  }
}

json.fn();   //ç»“æœæ˜¯undefinedï¼Œå› ä¸ºwindowå¯¹è±¡ä¸­æ²¡æœ‰a
```
ä½¿ç”¨æ„é€ å‡½æ•°ï¼š
```javascript
class Json{
  constructor(){
    this.a = 12;
    this.fn = ()=>{
      alert(this.a);
    }
  }
}

let json = new Json();
json.fn();   //12ï¼Œå› ä¸ºå½“å‰ç¯å¢ƒæ˜¯Jsonå¯¹è±¡ï¼ŒthisæŒ‡å‘Jsonå¯¹è±¡

let x = new Date();
x.fn = json.fn;
x.fn();     //12
```

### ä¸‰ã€å‡½æ•°çš„å‚æ•°æ‰©å±•ï¼ˆ...ï¼‰

ï¼ˆ1ï¼‰å‚æ•°å±•å¼€<br>
```javascript
function show(a, b, ...c){
  console.log(a,b,c);      //a=1,b=3,c=[4,2,6,8]
}

show(1,3,4,2,6,8);
```
```javascript
let arr = [1,5,8];
function show(a,b,c){
  alert(a+b+c);
}

show(...arr);   // 14
```
ï¼ˆ2ï¼‰æ•°ç»„å±•å¼€ åˆå¹¶æ•°ç»„<br>
```javascript
let arr1 = [1,5,8];
let arr2 = [4,5,6];
let arr = [...arr1, ...arr2];
alert(arr);   // [1,5,8,4,5,6]
```
ï¼ˆ3ï¼‰JSONå±•å¼€<br>
```javascript
let json = {a: 1, b: 5, c: 8};
let json2 = {
  ...json,
  d: 7
};
```

### å››ã€è§£æ„èµ‹å€¼

- æ•°ç»„çš„è§£æ„èµ‹å€¼

```javascript
[a, b] = [10, 20];  // a=10,b=20
[a, b, ...rest] = [1, 2, 3, 4, 5];  // a=1,b=2,rest=[3,4,5]

// åµŒå¥—æ•°ç»„è§£æ„
[a, [[b], c], d] = [1, [[2], 3], 4];

// ä¸éœ€è¦åŒ¹é…çš„ä½ç½®å¯ä»¥ç½®ç©º
[,,c] = [1, 2, 3];  // c=3
```

1ã€é»˜è®¤å€¼<br>

```javascript
# ä¸ºäº†é˜²æ­¢ä»æ•°ç»„ä¸­å–å‡ºä¸€ä¸ªå€¼ä¸ºundefinedçš„å¯¹è±¡ï¼Œå¯ä»¥åœ¨è¡¨è¾¾å¼å·¦è¾¹çš„æ•°ç»„ä¸­ä¸ºä»»æ„å¯¹è±¡é¢„è®¾é»˜è®¤å€¼
[a=5, b=7] = [1]; // a=1,b=7
```

2ã€äº¤æ¢å˜é‡<br>

```javascript
# åœ¨ä¸€ä¸ªè§£æ„è¡¨è¾¾å¼ä¸­å¯ä»¥äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼
[a, b] = [b, a];
```

3ã€è§£æä¸€ä¸ªä»å‡½æ•°è¿”å›çš„æ•°ç»„<br>

```javascript
# å¯ä»¥ä½¿ç”¨è§£æ„åœ¨ä¸€è¡Œå†…å®Œæˆè§£æ
function f() {
  return [1, 2];
}
var a, b;
[a, b] = f(); // a=1,b=2
```

- å¯¹è±¡çš„è§£æ„èµ‹å€¼

```javascript
// å˜é‡å¿…é¡»ä¸å±æ€§åŒå
let { a, b } = { a: 1, c: 2 };  // a=1,b=undefined
```

1ã€æ— å£°æ˜èµ‹å€¼<br>

```javascript
# å¦‚æœåœ¨è§£æ„ä¹‹å‰å°±å·²ç»å®šä¹‰äº†å¯¹è±¡
let obj;
{obj}={obj:'James'};  //æŠ¥é”™
# å¤§æ‹¬å·{}ä½äºè¡Œé¦–ï¼ŒJSå¼•æ“ å°±ä¼šè®¤ä¸º { obj } æ˜¯ä¸€ä¸ªä»£ç å—ï¼Œæ‰€ä»¥ç­‰å·å°±å‡ºé—®é¢˜äº†ã€‚
# è§£å†³æ–¹å¼æ˜¯åœ¨åŒ…è£¹ä¸€å±‚æ‹¬å·ï¼ˆï¼‰
let obj;
({obj}={obj:'James'});
# æ‹¬å·çš„å‡ºç°ï¼Œè®©æ•´ä¸ªè§£æ„èµ‹å€¼çš„ç»“æ„è¢«çœ‹åšä¸€ä¸ªä»£ç å—ï¼Œè€Œå†…éƒ¨çš„ { obj } æ¨¡å¼åˆ™å¯ä»¥æ­£å¸¸åŒ¹é…åˆ°ã€‚
```

2ã€å¯¹ä»»æ„æ·±åº¦çš„åµŒå¥—å¯¹è±¡è¿›è¡Œè§£æ„<br>

```javascript
let obj = { arr: [1, {a: 2}] };
let { arr: [x, {y}] } = obj;
```

3ã€è‡ªå®šä¹‰å±æ€§åç§°<br>

```javascript
var { name, id: ID } = { name: 'jack', id: 1 };  // ID=1
```

4ã€`for of`è¿­ä»£å’Œè§£æ„<br>

```javascript
var people = [{
    name: 'Mike Smith',
    family: {
      mother: 'Jane Smith',
      father: 'Harry Smith',
    },
    age: 35
  },
  {
    name: 'Tom Jones',
    family: {
      mother: 'Norah Jones',
      father: 'Richard Jones',
    },
    age: 25
  }];

for (var {name: n, family: {father: f}} of people) {
  console.log('Name: ' + n + ', Father: ' + f);
}

// "Name: Mike Smith, Father: Harry Smith"
// "Name: Tom Jones, Father: Richard Jones"
```

5ã€è§£æ„å¯¹è±¡æ—¶ä¼šæŸ¥æ‰¾åŸå‹é“¾ï¼ˆå¦‚æœå±æ€§ä¸åœ¨å¯¹è±¡è‡ªèº«ï¼Œå°†ä»åŸå‹é“¾ä¸­æŸ¥æ‰¾ï¼‰<br>

```javascript
// å£°æ˜å¯¹è±¡ å’Œ è‡ªèº« self å±æ€§
var obj = {self: '123'};
// åœ¨åŸå‹é“¾ä¸­å®šä¹‰ä¸€ä¸ªå±æ€§ prot
obj.__proto__.prot = '456';

const {self, prot} = obj;
// self "123"
// prot "456"ï¼ˆè®¿é—®åˆ°äº†åŸå‹é“¾ï¼‰
```

- å­—ç¬¦ä¸²è§£æ„

```javascript
const [a,b,c,d,e] = 'hello';
```

### äº”ã€åŸç”Ÿå¯¹è±¡æ‰©å±•
#### 1.Arrayæ‰©å±•ï¼šmapã€reduceã€filterã€forEach

- map æ˜ å°„ï¼šä¸€ä¸€å¯¹åº”

```javascript
let arr = [68,53,12,98,65];

let arr2 = arr.map(function (item){
  if(item>=60){
    return 'åŠæ ¼';
  }else{
    return 'ä¸åŠæ ¼';
  }
});

console.log(arr);
console.log(arr2);
```
ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼š<br>
```javascript
let arr = [68,53,12,98,65];
let arr2 = arr.map(item=>item>=60?'åŠæ ¼':'ä¸åŠæ ¼');
```
`map` åˆ›å»ºçš„å¯¹è±¡å¸¸ç”¨æ–¹æ³•ï¼š`set`ã€`get`ã€`delete`ã€`has`ã€`clear`ã€`keys`ã€`values`ã€`entries`ã€‚<br>

- reduce n=>1

```javascript
let arr = [68,53,12,98,65];
let result = arr.reduce(function (tmp, item, index){
  //alert(index+':'+tmp+','+item);
  return tmp+item;   //æ€»å’Œ
});

alert(result);
```
```javascript
// æ±‚å¹³å‡å€¼
let arr = [68,53,12,98,65];
let result = arr.reduce(function (tmp, item, index){
  if(index==arr.length-1){
    return (tmp+item)/arr.length;   //å¹³å‡å€¼
  }else{
    return tmp+item;   //æ€»å’Œ
  }
});

alert(result);
```

- filter è¿‡æ»¤

```javascript
// è·å–ä¸€ä¸ªæ•°ç»„ä¸­çš„å¶æ•°
let arr = [68,53,12,98,65,83,16];
let arr2 = arr.filter(item=>item%2==0);
```

- forEach éå†

```javascript
let arr = [68,53,12,98,65,83,16];
arr.forEach((item,index)=>{
  //alert('ç¬¬'+index+'ä¸ª:'+item);
  //ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²
  alert(`ç¬¬${index}ä¸ªï¼š${item}`);
});
```

#### 2.æ¨¡æ¿å­—ç¬¦ä¸²
#### 3.JSON

### å…­ã€å¼‚æ­¥æ“ä½œâ€”â€”Ajax,Promise
```javascript
ajax('http://aaa.com/a/1.txt',function(){});
```
**å¼‚æ­¥æ“ä½œï¼š**åŒæ—¶è¿›è¡Œå¤šä¸ªæ“ä½œï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼Œä»£ç æ··ä¹±<br>
**åŒæ­¥æ“ä½œï¼š**ä¸€æ¬¡åªèƒ½è¿›è¡Œä¸€ä¸ªæ“ä½œï¼Œç”¨æˆ·ä½“éªŒå·®ï¼Œä»£ç æ¸…æ™°<br>
å½“è®¸å¤šåŠŸèƒ½éœ€è¦è¿ç»­è°ƒç”¨ï¼ŒAjaxä»£ç å°±ä¼šä¸€å±‚ä¸€å±‚åµŒå¥—ï¼Œäº§ç”Ÿ`å›è°ƒåœ°ç‹±`ğŸ˜±<br>
**å›è°ƒåœ°ç‹±ï¼š**å‡½æ•°ä½œä¸ºå‚æ•°å±‚å±‚åµŒå¥—<br>
**å›è°ƒå‡½æ•°ï¼š**ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°éœ€è¦ä¾èµ–å¦ä¸€ä¸ªå‡½æ•°æ‰§è¡Œè°ƒç”¨<br>
**ä¾‹å­ï¼š**<br>
```javascript
ajax('url1',function (data1){
  ajax('url2',function (data2){
    ajax('url3',function (data3){
      //æ•°æ®å¤„ç†
    },function(){alert("error3!");})
  },function(){alert("error2!");})
},function(){alert("error1!");})
```
#### ä½¿ç”¨ES6æä¾›çš„Promiseå¯¹è±¡è§£å†³å¼‚æ­¥ç¼–ç¨‹
ä¾‹å­ï¼šè·å–æ–‡ä»¶`1.txt`ä¸­çš„ä¸€ä¸ªæ•°ç»„ï¼Œè¿è¡Œç¯å¢ƒç±»ä¼¼è¿™æ ·`localhost/demo/1.html`<br>
```javascript
// åˆ›å»ºä¸€ä¸ªPromiseå¯¹è±¡
let p = new Promise(function (resolve,reject){
  $.ajax({
    url:'data/1.txt',
    dataType:'json',
    success(arr){
      resolve(arr);
    },
    error(res){
      reject(res);
    }
  })
});
// thenæ–¹æ³•æŒ‡å®šresolveçŠ¶æ€å’ŒrejectçŠ¶æ€çš„å›è°ƒå‡½æ•°
// p.then(function(){},function(){});
p.then(function(arr){
  console.log(arr+'success');
},function(res){
  console.log(res+'error');
});
```
JQueryä¸­çš„`$.ajax`ä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªPromise<br>

```javascript
// éªŒè¯$.ajaxçš„ç»“æœ
let res = $.ajax({
  url:'data/1.txt',
  dataType:'json'
});

console.log(res);
```

å› æ­¤å¯ä»¥è°ƒç”¨thenæ–¹æ³•ï¼š<br>

```javascript
$.ajax({
  url:'data/1.txt',
  dataType:'json'
}).then(arr=>{
  alert(arr);
},res=>{
  alert('å¤±è´¥');
});
```
#### ä½¿ç”¨`Promise.all()`æ–¹æ³•åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚
```javascript
Promise.all([
  $.ajax({url:'data/1.txt',dataType:'json'}),
  $.ajax({url:'data/2.txt',dataType:'json'}),
  $.ajax({url:'data/3.txt',dataType:'json'}),
]).then(arr=>{
  console.log(arr);   //arræ˜¯ä¸€ä¸ªæ•°ç»„
  let [data1,data2,data3] = arr;   //è§£æ„èµ‹å€¼ï¼Œä¹Ÿå¯ç›´æ¥åœ¨å‚æ•°é‡Œè§£æ„
  console.log(data2);
},res=>{
  alert('å¤±è´¥');
});
```
**æ³¨æ„ï¼š**ä½¿ç”¨`Promise.all()`éœ€è¦å‡ ä¸ªè¯·æ±‚å…¨éƒ¨æˆåŠŸæ‰è¡Œ<br>
`Promise.race()`åªè¦æœ‰ä¸€ä¸ªå®ä¾‹çŠ¶æ€ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼ŒPromiseå®ä¾‹å°±è·Ÿç€æ”¹å˜<br>

### ä¸ƒã€async/awaitå‡½æ•°
1. generator/yieldå·²ç»è¢«async/awaitå–ä»£ï¼›<br>
2. `async`æ”¾åœ¨å‡½æ•°å‰é¢ï¼Œè¡¨ç¤º**å¼‚æ­¥æ‰§è¡Œ**ï¼Œè¯¥å‡½æ•°çš„æ‰§è¡Œä¸é˜»å¡åé¢ä»£ç çš„æ‰§è¡Œï¼›<br>
3. `await`è¡¨ç¤ºç­‰å¾…awaitåé¢çš„å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”æœ‰äº†è¿”å›ç»“æœä¹‹åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚<br>

```javascript
async function show(){
  let a=12;
  let b=5;

  try {
    let data = await $.ajax({url:'data/1.txt',dataType:'json'});
    alert(a+b+data[0]);
  } catch(e) {
    alert("è¯»å–å¤±è´¥");
  }
}

show();
```

### å…«ã€é¢å‘å¯¹è±¡ã€æ¨¡å—åŒ–
#### 1.ç±»çš„æ„é€ å‡½æ•°
```javascript
class Person{
  constructor(name,age){
    this.name = name;
    this.age = age;
  }

  showName(){
    alert(this.name);
  }

  showAge(){
    alert(this.age);
  }
}

let p = new Person('xl',18);
p.showName();
p.showAge();
```
#### 2.ç±»çš„ç»§æ‰¿
```javascript
class Worker extends Person{
  constructor(name,age,job){
    super(name,age);
    this.job = job;
  }

  showJob(){
    alert(this.job);
  }
}

let p = new Person('xl',18,'Java');
p.showName();
p.showAge();
p.showJob();
```
#### 3.æ¨¡å—åŒ–
ï¼ˆ1ï¼‰å¯¼å…¥<br>
ï¼ˆ2ï¼‰å¯¼å‡º<br>
ï¼ˆ3ï¼‰webpackç¼–è¯‘ï¼šå› ä¸ºæµè§ˆå™¨ä¸æ”¯æŒES6æ¨¡å—<br>
```javascript
//modle.js - å®šä¹‰æ¨¡å—
export let a = 12;
```
```javascript
//index.js - ä½¿ç”¨æ¨¡å—
import * as modle from './modle';

alert(modle.a);
```
```html
//index.html
<script src="index.js"></script>
```
```javascript
//webpack.config.js - ç¼–è¯‘é…ç½®
const pathlib = require('path');

module.exports={
  mode:"production",
  entry:"./js/index.js",
  output:{
    path: pathlib.resolve(__dirname,'build'),
    filename:'bundle.js'
  }
}
```
ä½¿ç”¨cmdå‘½ä»¤è¡Œçª—å£è¿è¡Œå‘½ä»¤`webpack`ï¼Œå°±ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆbuildæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰æ–‡ä»¶`bundle.js`<br>
ç„¶åindex.htmlä¸­å¼•å…¥`bundle.js`<br>
ï¼ˆ4ï¼‰é»˜è®¤æˆå‘˜<br>
```css
export default 9;
```

```css
import modle from './modle';

console.log(modle);     // 9
```
ï¼ˆ5ï¼‰å‡ ç§å¼•å…¥çš„å†™æ³•<br>
```css
import * as mod from 'xxx';    //å¼•å…¥æ‰€æœ‰æˆå‘˜
import mod from 'xxx';         //å¼•å…¥defaultæˆå‘˜
import {a,b as c} from 'xxx';
import 'xxx';
let p = import("./mod");       //å¼‚æ­¥å¼•å…¥
```
---
#### å­¦ä¹ è§†é¢‘ï¼š[æ™ºèƒ½ç¤¾-ES6ç²¾è®²](https://www.bilibili.com/video/av41783773)